import pytest
from mathutils import Vector

from bpypolyskel import bpypolyskel

verts = [
    Vector((-0.035724639892578125, 0.2782987356185913, 0.0)),
    Vector((13.761125564575195, 2.3822548389434814, 0.0)),
    Vector((13.825430870056152, 1.9815047979354858, 0.0)),
    Vector((14.347010612487793, 2.059429883956909, 0.0)),
    Vector((14.289850234985352, 2.404520034790039, 0.0)),
    Vector((14.6399507522583, 2.4601807594299316, 0.0)),
    Vector((14.575645446777344, 2.949986457824707, 0.0)),
    Vector((14.289848327636719, 2.9054577350616455, 0.0)),
    Vector((13.589632034301758, 8.237659454345703, 0.0)),
    Vector((13.889719009399414, 8.282188415527344, 0.0)),
    Vector((13.803977966308594, 8.938973426818848, 0.0)),
    Vector((13.34670352935791, 8.849916458129883, 0.0)),
    Vector((12.239222526550293, 17.254535675048828, 0.0)),
    Vector((12.725075721740723, 17.332460403442383, 0.0)),
    Vector((12.646480560302734, 17.922452926635742, 0.0)),
    Vector((12.160627365112305, 17.85565948486328, 0.0)),
    Vector((11.438980102539062, 23.288049697875977, 0.0)),
    Vector((11.946268081665039, 23.34370994567871, 0.0)),
    Vector((11.881962776184082, 23.866912841796875, 0.0)),
    Vector((11.374674797058105, 23.800119400024414, 0.0)),
    Vector((10.260054588317871, 32.238136291503906, 0.0)),
    Vector((10.795921325683594, 32.31605911254883, 0.0)),
    Vector((10.71018123626709, 32.972843170166016, 0.0)),
    Vector((10.324357032775879, 32.95058059692383, 0.0)),
    Vector((9.68130874633789, 38.00448226928711, 0.0)),
    Vector((10.052842140197754, 38.07127380371094, 0.0)),
    Vector((9.96710205078125, 38.71692657470703, 0.0)),
    Vector((9.531265258789062, 38.6612663269043, 0.0)),
    Vector((9.495540618896484, 38.984092712402344, 0.0)),
    Vector((8.823922157287598, 38.89503860473633, 0.0)),
    Vector((8.85250186920166, 38.59447479248047, 0.0)),
    Vector((-4.987125396728516, 36.80222702026367, 0.0)),
    Vector((-5.0228495597839355, 37.09165573120117, 0.0)),
    Vector((-5.515846252441406, 37.024864196777344, 0.0)),
    Vector((-5.465832710266113, 36.668643951416016, 0.0)),
    Vector((-5.801641941070557, 36.64638137817383, 0.0)),
    Vector((-5.723048686981201, 36.02299118041992, 0.0)),
    Vector((-5.394384384155273, 36.078651428222656, 0.0)),
    Vector((-4.286934852600098, 27.66289520263672, 0.0)),
    Vector((-10.24577522277832, 26.894798278808594, 0.0)),
    Vector((-10.560151100158691, 26.8280086517334, 0.0)),
    Vector((-10.47441291809082, 26.226882934570312, 0.0)),
    Vector((-10.15289306640625, 26.2491455078125, 0.0)),
    Vector((-9.56701946258545, 21.985607147216797, 0.0)),
    Vector((-9.981423377990723, 21.94108009338379, 0.0)),
    Vector((-9.9099760055542, 21.32882308959961, 0.0)),
    Vector((-9.481281280517578, 21.384483337402344, 0.0)),
    Vector((-9.20263385772705, 19.35846710205078, 0.0)),
    Vector((-9.767081260681152, 19.291677474975586, 0.0)),
    Vector((-9.674199104309082, 18.47904396057129, 0.0)),
    Vector((-9.095462799072266, 18.20074462890625, 0.0)),
    Vector((-8.931132316589355, 16.887174606323242, 0.0)),
    Vector((-9.438421249389648, 16.43076515197754, 0.0)),
    Vector((-9.352683067321777, 15.740584373474121, 0.0)),
    Vector((-8.802525520324707, 15.807374954223633, 0.0)),
    Vector((-8.566746711730957, 13.781359672546387, 0.0)),
    Vector((-9.02402114868164, 13.725700378417969, 0.0)),
    Vector((-8.945427894592285, 13.068915367126465, 0.0)),
    Vector((-8.345255851745605, 13.135706901550293, 0.0)),
    Vector((-7.759378910064697, 8.89443302154541, 0.0)),
    Vector((-8.102334976196289, 8.849905967712402, 0.0)),
    Vector((-8.016596794128418, 8.226516723632812, 0.0)),
    Vector((-1.8648231029510498, 9.15046215057373, 0.0)),
    Vector((-0.7502173185348511, 0.8126323223114014, 0.0)),
    Vector((-1.1074637174606323, 0.7569726705551147, 0.0)),
    Vector((-1.0431594848632812, 0.2560349404811859, 0.0)),
    Vector((-0.6787681579589844, 0.30056267976760864, 0.0)),
    Vector((-0.628753662109375, -0.08905555307865143, 0.0)),
    Vector((0.0, 0.0, 0.0)),
    Vector((-0.035724639892578125, 0.2782987356185913, 12.190017700195312)),
    Vector((13.761125564575195, 2.3822548389434814, 12.190017700195312)),
    Vector((13.825430870056152, 1.9815047979354858, 12.190017700195312)),
    Vector((14.347010612487793, 2.059429883956909, 12.190017700195312)),
    Vector((14.289850234985352, 2.404520034790039, 12.190017700195312)),
    Vector((14.6399507522583, 2.4601807594299316, 12.190017700195312)),
    Vector((14.575645446777344, 2.949986457824707, 12.190017700195312)),
    Vector((14.289848327636719, 2.9054577350616455, 12.190017700195312)),
    Vector((13.589632034301758, 8.237659454345703, 12.190017700195312)),
    Vector((13.889719009399414, 8.282188415527344, 12.190017700195312)),
    Vector((13.803977966308594, 8.938973426818848, 12.190017700195312)),
    Vector((13.34670352935791, 8.849916458129883, 12.190017700195312)),
    Vector((12.239222526550293, 17.254535675048828, 12.190017700195312)),
    Vector((12.725075721740723, 17.332460403442383, 12.190017700195312)),
    Vector((12.646480560302734, 17.922452926635742, 12.190017700195312)),
    Vector((12.160627365112305, 17.85565948486328, 12.190017700195312)),
    Vector((11.438980102539062, 23.288049697875977, 12.190017700195312)),
    Vector((11.946268081665039, 23.34370994567871, 12.190017700195312)),
    Vector((11.881962776184082, 23.866912841796875, 12.190017700195312)),
    Vector((11.374674797058105, 23.800119400024414, 12.190017700195312)),
    Vector((10.260054588317871, 32.238136291503906, 12.190017700195312)),
    Vector((10.795921325683594, 32.31605911254883, 12.190017700195312)),
    Vector((10.71018123626709, 32.972843170166016, 12.190017700195312)),
    Vector((10.324357032775879, 32.95058059692383, 12.190017700195312)),
    Vector((9.68130874633789, 38.00448226928711, 12.190017700195312)),
    Vector((10.052842140197754, 38.07127380371094, 12.190017700195312)),
    Vector((9.96710205078125, 38.71692657470703, 12.190017700195312)),
    Vector((9.531265258789062, 38.6612663269043, 12.190017700195312)),
    Vector((9.495540618896484, 38.984092712402344, 12.190017700195312)),
    Vector((8.823922157287598, 38.89503860473633, 12.190017700195312)),
    Vector((8.85250186920166, 38.59447479248047, 12.190017700195312)),
    Vector((-4.987125396728516, 36.80222702026367, 12.190017700195312)),
    Vector((-5.0228495597839355, 37.09165573120117, 12.190017700195312)),
    Vector((-5.515846252441406, 37.024864196777344, 12.190017700195312)),
    Vector((-5.465832710266113, 36.668643951416016, 12.190017700195312)),
    Vector((-5.801641941070557, 36.64638137817383, 12.190017700195312)),
    Vector((-5.723048686981201, 36.02299118041992, 12.190017700195312)),
    Vector((-5.394384384155273, 36.078651428222656, 12.190017700195312)),
    Vector((-4.286934852600098, 27.66289520263672, 12.190017700195312)),
    Vector((-10.24577522277832, 26.894798278808594, 12.190017700195312)),
    Vector((-10.560151100158691, 26.8280086517334, 12.190017700195312)),
    Vector((-10.47441291809082, 26.226882934570312, 12.190017700195312)),
    Vector((-10.15289306640625, 26.2491455078125, 12.190017700195312)),
    Vector((-9.56701946258545, 21.985607147216797, 12.190017700195312)),
    Vector((-9.981423377990723, 21.94108009338379, 12.190017700195312)),
    Vector((-9.9099760055542, 21.32882308959961, 12.190017700195312)),
    Vector((-9.481281280517578, 21.384483337402344, 12.190017700195312)),
    Vector((-9.20263385772705, 19.35846710205078, 12.190017700195312)),
    Vector((-9.767081260681152, 19.291677474975586, 12.190017700195312)),
    Vector((-9.674199104309082, 18.47904396057129, 12.190017700195312)),
    Vector((-9.095462799072266, 18.20074462890625, 12.190017700195312)),
    Vector((-8.931132316589355, 16.887174606323242, 12.190017700195312)),
    Vector((-9.438421249389648, 16.43076515197754, 12.190017700195312)),
    Vector((-9.352683067321777, 15.740584373474121, 12.190017700195312)),
    Vector((-8.802525520324707, 15.807374954223633, 12.190017700195312)),
    Vector((-8.566746711730957, 13.781359672546387, 12.190017700195312)),
    Vector((-9.02402114868164, 13.725700378417969, 12.190017700195312)),
    Vector((-8.945427894592285, 13.068915367126465, 12.190017700195312)),
    Vector((-8.345255851745605, 13.135706901550293, 12.190017700195312)),
    Vector((-7.759378910064697, 8.89443302154541, 12.190017700195312)),
    Vector((-8.102334976196289, 8.849905967712402, 12.190017700195312)),
    Vector((-8.016596794128418, 8.226516723632812, 12.190017700195312)),
    Vector((-1.8648231029510498, 9.15046215057373, 12.190017700195312)),
    Vector((-0.7502173185348511, 0.8126323223114014, 12.190017700195312)),
    Vector((-1.1074637174606323, 0.7569726705551147, 12.190017700195312)),
    Vector((-1.0431594848632812, 0.2560349404811859, 12.190017700195312)),
    Vector((-0.6787681579589844, 0.30056267976760864, 12.190017700195312)),
    Vector((-0.628753662109375, -0.08905555307865143, 12.190017700195312)),
    Vector((0.0, 0.0, 12.190017700195312))
]
unitVectors = [
    Vector((0.9885715246200562, 0.15075261890888214, 0.0)),
    Vector((0.1584356278181076, -0.9873692989349365, 0.0)),
    Vector((0.9890229105949402, 0.14776206016540527, 0.0)),
    Vector((-0.163412407040596, 0.9865577816963196, 0.0)),
    Vector((0.9875965118408203, 0.15701301395893097, 0.0)),
    Vector((-0.13017034530639648, 0.9914916753768921, 0.0)),
    Vector((-0.9880790114402771, -0.15394800901412964, 0.0)),
    Vector((-0.1302005797624588, 0.9914876818656921, 0.0)),
    Vector((0.9891692399978638, 0.14677970111370087, 0.0)),
    Vector((-0.12944819033145905, 0.9915862083435059, 0.0)),
    Vector((-0.9815580248832703, -0.19116437435150146, 0.0)),
    Vector((-0.13064120709896088, 0.9914297461509705, 0.0)),
    Vector((0.9873809218406677, 0.1583634465932846, 0.0)),
    Vector((-0.13204734027385712, 0.9912434816360474, 0.0)),
    Vector((-0.9906820058822632, -0.1361955851316452, 0.0)),
    Vector((-0.13168473541736603, 0.9912915825843811, 0.0)),
    Vector((0.9940344095230103, 0.10906665027141571, 0.0)),
    Vector((-0.12198907136917114, 0.992531418800354, 0.0)),
    Vector((-0.9914429187774658, -0.13054101169109344, 0.0)),
    Vector((-0.1309574395418167, 0.9913880228996277, 0.0)),
    Vector((0.9895921349525452, 0.14390109479427338, 0.0)),
    Vector((-0.12944695353507996, 0.9915863275527954, 0.0)),
    Vector((-0.9983394145965576, -0.05760551989078522, 0.0)),
    Vector((-0.12622037529945374, 0.9920022487640381, 0.0)),
    Vector((0.9842222929000854, 0.17693623900413513, 0.0)),
    Vector((-0.13164031505584717, 0.9912974834442139, 0.0)),
    Vector((-0.9919435381889343, -0.12668004631996155, 0.0)),
    Vector((-0.10999064892530441, 0.9939325451850891, 0.0)),
    Vector((-0.9913234114646912, -0.13144579529762268, 0.0)),
    Vector((0.09466003626585007, -0.995509684085846, 0.0)),
    Vector((-0.9917187690734863, -0.12842872738838196, 0.0)),
    Vector((-0.12250030785799026, 0.9924684762954712, 0.0)),
    Vector((-0.9909469485282898, -0.13425418734550476, 0.0)),
    Vector((0.13903692364692688, -0.990287184715271, 0.0)),
    Vector((-0.9978097081184387, -0.06615009158849716, 0.0)),
    Vector((0.1250837743282318, -0.9921461939811707, 0.0)),
    Vector((0.9859610795974731, 0.16697534918785095, 0.0)),
    Vector((0.13046762347221375, -0.9914526343345642, 0.0)),
    Vector((-0.9917944073677063, -0.12784269452095032, 0.0)),
    Vector((-0.9781684875488281, -0.20781336724758148, 0.0)),
    Vector((0.14120036363601685, -0.9899809956550598, 0.0)),
    Vector((0.997611403465271, 0.0690762847661972, 0.0)),
    Vector((0.13613556325435638, -0.9906901717185974, 0.0)),
    Vector((-0.9942768812179565, -0.10683350265026093, 0.0)),
    Vector((0.11590852588415146, -0.9932599067687988, 0.0)),
    Vector((0.9916762709617615, 0.1287558376789093, 0.0)),
    Vector((0.1362520307302475, -0.9906741976737976, 0.0)),
    Vector((-0.9930720329284668, -0.1175076887011528, 0.0)),
    Vector((0.11355836689472198, -0.993531346321106, 0.0)),
    Vector((0.9012154340744019, -0.4333712160587311, 0.0)),
    Vector((0.12413457036018372, -0.9922654032707214, 0.0)),
    Vector((-0.7434037923812866, -0.6688427329063416, 0.0)),
    Vector((0.12327811121940613, -0.9923721551895142, 0.0)),
    Vector((0.9927111268043518, 0.12051776051521301, 0.0)),
    Vector((0.1155954897403717, -0.9932963848114014, 0.0)),
    Vector((-0.9926734566688538, -0.12082789093255997, 0.0)),
    Vector((0.11881592869758606, -0.9929162859916687, 0.0)),
    Vector((0.9938645362854004, 0.11060450971126556, 0.0)),
    Vector((0.1368376463651657, -0.9905935525894165, 0.0)),
    Vector((-0.9916767477989197, -0.12875248491764069, 0.0)),
    Vector((0.13625290989875793, -0.9906741380691528, 0.0)),
    Vector((0.9889085292816162, 0.14852586388587952, 0.0)),
    Vector((0.13250187039375305, -0.9911826848983765, 0.0)),
    Vector((-0.9880794286727905, -0.15394461154937744, 0.0)),
    Vector((0.1273229718208313, -0.9918612837791443, 0.0)),
    Vector((0.9926164746284485, 0.12129533290863037, 0.0)),
    Vector((0.1273232102394104, -0.9918612241744995, 0.0)),
    Vector((0.9901177287101746, 0.14023852348327637, 0.0)),
    Vector((-0.1273232102394104, 0.9918612837791443, 0.0))
]
holesInfo = None
firstVertIndex = 69
numPolygonVerts = 69
faces = []

bpypolyskel.debugOutputs["skeleton"] = 1


@pytest.mark.dependency()
@pytest.mark.timeout(10)
def test_polygonize():
    global faces
    faces = bpypolyskel.polygonize(verts, firstVertIndex, numPolygonVerts, holesInfo, 0.0, 0.5, None, unitVectors)


@pytest.mark.dependency(depends=["test_polygonize"])
def test_numVertsInFace():
    for face in faces:
        assert len(face) >= 3


@pytest.mark.dependency(depends=["test_polygonize"])
def test_duplication():
    for face in faces:
        assert len(face) == len(set(face))


@pytest.mark.dependency(depends=["test_polygonize"])
def test_edgeCrossing():
    assert not bpypolyskel.check_edge_crossing(bpypolyskel.debugOutputs["skeleton"])
