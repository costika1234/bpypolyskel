import pytest
from mathutils import Vector

from bpypolyskel import bpypolyskel

verts = [
    Vector((0.0, 0.0, 0.0)),
    Vector((2.0570731163024902, -2.2263894081115723, 0.0)),
    Vector((2.0570731163024902, -2.504688262939453, 0.0)),
    Vector((2.0936758518218994, -2.6494035720825195, 0.0)),
    Vector((2.0936760902404785, -2.782986879348755, 0.0)),
    Vector((2.1595609188079834, -3.0612854957580566, 0.0)),
    Vector((2.2254459857940674, -3.18373703956604, 0.0)),
    Vector((2.254728078842163, -3.3173203468322754, 0.0)),
    Vector((2.452383041381836, -3.6846745014190674, 0.0)),
    Vector((2.5475502014160156, -3.807126045227051, 0.0)),
    Vector((2.6134352684020996, -3.907313585281372, 0.0)),
    Vector((2.803769588470459, -4.14108419418335, 0.0)),
    Vector((2.869654417037964, -4.207876205444336, 0.0)),
    Vector((2.9648215770721436, -4.274667739868164, 0.0)),
    Vector((3.0307066440582275, -4.341459274291992, 0.0)),
    Vector((3.1258738040924072, -4.397119045257568, 0.0)),
    Vector((3.221040964126587, -4.441646575927734, 0.0)),
    Vector((3.3162081241607666, -4.4973063468933105, 0.0)),
    Vector((3.4113752841949463, -4.530702114105225, 0.0)),
    Vector((3.506542444229126, -4.575230121612549, 0.0)),
    Vector((3.6017096042633057, -4.597493648529053, 0.0)),
    Vector((3.6968765258789062, -4.630889415740967, 0.0)),
    Vector((3.792043685913086, -4.653153419494629, 0.0)),
    Vector((4.106827259063721, -4.697680950164795, 0.0)),
    Vector((4.267879486083984, -4.686548709869385, 0.0)),
    Vector((6.383520603179932, -6.990860462188721, 0.0)),
    Vector((12.122820854187012, -1.8144944906234741, 0.0)),
    Vector((5.775901794433594, 5.220887184143066, 0.0)),
    Vector((0.0, 0.0, 3.1158981323242188)),
    Vector((2.0570731163024902, -2.2263894081115723, 3.1158981323242188)),
    Vector((2.0570731163024902, -2.504688262939453, 3.1158981323242188)),
    Vector((2.0936758518218994, -2.6494035720825195, 3.1158981323242188)),
    Vector((2.0936760902404785, -2.782986879348755, 3.1158981323242188)),
    Vector((2.1595609188079834, -3.0612854957580566, 3.1158981323242188)),
    Vector((2.2254459857940674, -3.18373703956604, 3.1158981323242188)),
    Vector((2.254728078842163, -3.3173203468322754, 3.1158981323242188)),
    Vector((2.452383041381836, -3.6846745014190674, 3.1158981323242188)),
    Vector((2.5475502014160156, -3.807126045227051, 3.1158981323242188)),
    Vector((2.6134352684020996, -3.907313585281372, 3.1158981323242188)),
    Vector((2.803769588470459, -4.14108419418335, 3.1158981323242188)),
    Vector((2.869654417037964, -4.207876205444336, 3.1158981323242188)),
    Vector((2.9648215770721436, -4.274667739868164, 3.1158981323242188)),
    Vector((3.0307066440582275, -4.341459274291992, 3.1158981323242188)),
    Vector((3.1258738040924072, -4.397119045257568, 3.1158981323242188)),
    Vector((3.221040964126587, -4.441646575927734, 3.1158981323242188)),
    Vector((3.3162081241607666, -4.4973063468933105, 3.1158981323242188)),
    Vector((3.4113752841949463, -4.530702114105225, 3.1158981323242188)),
    Vector((3.506542444229126, -4.575230121612549, 3.1158981323242188)),
    Vector((3.6017096042633057, -4.597493648529053, 3.1158981323242188)),
    Vector((3.6968765258789062, -4.630889415740967, 3.1158981323242188)),
    Vector((3.792043685913086, -4.653153419494629, 3.1158981323242188)),
    Vector((4.106827259063721, -4.697680950164795, 3.1158981323242188)),
    Vector((4.267879486083984, -4.686548709869385, 3.1158981323242188)),
    Vector((6.383520603179932, -6.990860462188721, 3.1158981323242188)),
    Vector((12.122820854187012, -1.8144944906234741, 3.1158981323242188)),
    Vector((5.775901794433594, 5.220887184143066, 3.1158981323242188))
]
unitVectors = [
    Vector((0.6786264181137085, -0.7344836592674255, 0.0)),
    Vector((0.0, -1.0, 0.0)),
    Vector((0.2452075034379959, -0.9694706797599792, 0.0)),
    Vector((1.7847931985670584e-06, -1.0, 0.0)),
    Vector((0.23037366569042206, -0.9731022119522095, 0.0)),
    Vector((0.47381889820098877, -0.8806222677230835, 0.0)),
    Vector((0.2141207605600357, -0.9768072366714478, 0.0)),
    Vector((0.47381895780563354, -0.8806222677230835, 0.0)),
    Vector((0.6136475801467896, -0.7895801067352295, 0.0)),
    Vector((0.5494547486305237, -0.8355234861373901, 0.0)),
    Vector((0.6313830018043518, -0.7754712104797363, 0.0)),
    Vector((0.7022554874420166, -0.7119249701499939, 0.0)),
    Vector((0.8185260891914368, -0.5744693279266357, 0.0)),
    Vector((0.7022593021392822, -0.7119211554527283, 0.0)),
    Vector((0.8632035851478577, -0.5048560500144958, 0.0)),
    Vector((0.9057588577270508, -0.42379331588745117, 0.0)),
    Vector((0.8632035851478577, -0.5048560500144958, 0.0)),
    Vector((0.9435883164405823, -0.3311210870742798, 0.0)),
    Vector((0.9057571887969971, -0.42379704117774963, 0.0)),
    Vector((0.9737101197242737, -0.2277909815311432, 0.0)),
    Vector((0.9435880184173584, -0.3311218321323395, 0.0)),
    Vector((0.9737089276313782, -0.2277955859899521, 0.0)),
    Vector((0.9901430010795593, -0.14006011188030243, 0.0)),
    Vector((0.9976195693016052, 0.0689573884010315, 0.0)),
    Vector((0.676307201385498, -0.7366195917129517, 0.0)),
    Vector((0.7425863146781921, 0.6697503924369812, 0.0)),
    Vector((-0.6698432564735413, 0.7425024509429932, 0.0)),
    Vector((-0.7418506741523743, -0.6705651879310608, 0.0))
]
holesInfo = None
firstVertIndex = 28
numPolygonVerts = 28
faces = []

bpypolyskel.debugOutputs["skeleton"] = 1


@pytest.mark.dependency()
@pytest.mark.timeout(10)
def test_polygonize():
    global faces
    faces = bpypolyskel.polygonize(verts, firstVertIndex, numPolygonVerts, holesInfo, 0.0, 0.5, None, unitVectors)


@pytest.mark.dependency(depends=["test_polygonize"])
def test_numVertsInFace():
    for face in faces:
        assert len(face) >= 3


@pytest.mark.dependency(depends=["test_polygonize"])
def test_duplication():
    for face in faces:
        assert len(face) == len(set(face))


@pytest.mark.dependency(depends=["test_polygonize"])
def test_edgeCrossing():
    assert not bpypolyskel.check_edge_crossing(bpypolyskel.debugOutputs["skeleton"])
